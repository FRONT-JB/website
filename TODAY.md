# React.js & Next.js 생태계

## Fiber

- React 15 -> React 16 버전에서 Fiber 라는 새로운 재조정 엔진을 도입함
- 기존 스택 기반 재조정 방식을 벗어나 비동기 렌더링과 우선순위 기반 업데이트가 가능함
- 향후 Concurrent Mode(동시성 모드)의 기반이 됨

### 왜 Fiber를 적용한걸까?

- 기존은 재귀적으로 컴포넌트 트리를 순회하며 DOM을 한 번에 업데이트 했지만 이는 큰 UI나 복잡한 상호작용이 잇을 때 프레임 드롭이나 브라우저 응답 저하를 유발
  - 렌더링 작업이 동기적이고 중단이 불가능함
  - 렌더링이 오래 걸리면 브라우저가 사용자 입력을 받지 못함

### Fiber를 통해 구현하고자 했던 것 (목표)

- 타임 슬라이싱
  - 렌더링 **작업을 조각내어 스케줄링**하고 유휴 시간에 나머지 작업을 실행해 렌더링 중단 가능
- 재시도 및 취소
  - 작업 중간에 중단하고 **더 중요한 작업을 먼저 처리** 가능
- 동시성
  - 비동기적으로 여러 작업을 동시에 준비하고 최종 커밋 시점에 선택적으로 DOM에 반영
  - Suspense, Concurrent Mode, React Server Components들을 위한 기반
- 더 유연한 업데이트 구조
  - 에러 바운더리, Suspense, Lazy Loading

### Fiber 구조

- 각 React 컴포넌트는 Fiber Node라는 객체로 변환되며 트리 형태로 변경됨
  - 기존 구조: 10,000개 렌더링 시 -> 전체 트리 한번에 처리 -> UI 멈춤
  - Fiber 구조: 리스트 100개 단위로 쪼개서 처리 -> 중간에 입력이 들어오면 처리 -> 프레임 손실 방지

## 렌더링 단계 분리: Render vs Commit

- Render Phase (렌더 단계)
  - 어떤 UI를 어떻게 바꿔야 할지 계산하는 단계
  - `Diffing` 또는 `Reconciliation` 이라고도 함
  - DOM을 실제로 바꾸지 않음
  - 중단 가능
- Commit Phase (커밋 단계)
  - 실제 DOM을 업데이트 하는 단계
  - Side-Effect (useEffect, componentDidMount 등) 실행
  - 중단 불가
- `Commit Phase는 반드시 단일 실행`
  - DOM을 중간에 수정하다가 말면 화면이 깨지거나 예측 불가능한 동작이 생기기 때문에 **커밋은 무조건 원자적으로 실행돼야 한다.**
